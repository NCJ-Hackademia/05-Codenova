<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2D Design - Live N Fit</title>
    <meta name="description" content="Visualize your home with our intuitive 2D design tools. Create and customize your floor plans with ease." />
    <link rel="stylesheet" href="../css/main.css" />
    <style>
        .svg-floorplan {
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 1rem;
            margin: 0 auto 2rem auto;
            display: block;
        }
        .details-box {
            background: #f3f4f6;
            border-radius: 1rem;
            padding: 1.5rem;
            margin: 0 auto 2rem auto;
            max-width: 600px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .details-box h2 {
            font-size: 1.3rem;
            font-weight: bold;
            color: #3730a3;
            margin-bottom: 1rem;
        }
        .details-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .details-list li {
            margin-bottom: 0.5rem;
            color: #374151;
        }
        .action-btns {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        .btn-main {
            background: #6366f1;
            color: #fff;
            font-weight: bold;
            padding: 0.75rem 2.5rem;
            border-radius: 0.75rem;
            border: none;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-main:hover {
            background: #4338ca;
        }
        .btn-secondary {
            background: #f3f4f6;
            color: #6366f1;
            font-weight: bold;
            padding: 0.75rem 2.5rem;
            border-radius: 0.75rem;
            border: 2px solid #6366f1;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }
        .btn-secondary:hover {
            background: #6366f1;
            color: #fff;
        }
    </style>
</head>
<body class="bg-background font-body">
    <!-- Navigation Header (copied from design_form_portal) -->
    <nav class="bg-surface shadow-card sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="{{url_for('homepage')}}" class="flex flex-col items-start space-y-0.5 space-x-2">
                        <span class="flex items-center space-x-2">
                            <svg class="w-8 h-8 text-secondary" viewBox="0 0 32 32" fill="currentColor">
                                <path d="M16 2L4 12v18h8v-8h8v8h8V12L16 2zm0 4.5L24 14v14h-4v-8H12v8H8V14l8-7.5z"/>
                                <circle cx="16" cy="18" r="2" fill="currentColor"/>
                            </svg>
                            <span class="font-headline font-bold text-xl text-primary">Live N Fit</span>
                        </span>
                        <span class="text-sm text-text-secondary font-medium mt-1">
                            {% if session['user_name'] %}
                                Welcome {{ session['user_name'] }}!
                            {% endif %}
                        </span>
                    </a>
                </div>
                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="{{ url_for('homepage') }}" class="text-text-secondary hover:text-primary transition-quick">Home</a>
                    <a href="{{ url_for('about') }}" class="text-text-secondary hover:text-primary transition-quick">About</a>
                    <a href="{{ url_for('design_portal') }}" class="text-text-secondary hover:text-primary transition-quick">Design</a>
                    <a href="{{ url_for('design_2d') }}" class="text-primary font-semibold border-b-2 border-secondary">2D Design</a>
                    <a href="{{ url_for('pricing') }}" class="text-text-secondary hover:text-primary transition-quick">Pricing</a>
                    <a href="{{ url_for('designs_gallery') }}" class="text-text-secondary hover:text-primary transition-quick">My Designs</a>
                    <a href="{{ url_for('tech_deep_dive') }}" class="text-text-secondary hover:text-primary transition-quick">Technology</a>
                    <a href="{{ url_for('contact') }}" class="text-text-secondary hover:text-primary transition-quick">Contact</a>
                </div>
                <!-- Save Progress Button -->
                <div class="hidden md:block">
                    <button class="text-secondary font-semibold hover:text-secondary-600 transition-quick">
                        Save Progress
                    </button>
                </div>
                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button id="mobile-menu-btn" class="text-primary hover:text-secondary transition-quick">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="md:hidden hidden bg-surface border-t border-border">
            <div class="px-4 py-2 space-y-2">
                <a href="{{ url_for('homepage') }}" class="block py-2 text-text-secondary hover:text-primary transition-quick">Home</a>
                <a href="{{ url_for('about') }}" class="block py-2 text-text-secondary hover:text-primary transition-quick">About</a>
                <a href="{{ url_for('design_portal') }}" class="block py-2 text-text-secondary hover:text-primary transition-quick">Design</a>
                <a href="{{ url_for('design_2d') }}" class="block py-2 text-primary font-semibold">2D Design</a>
                <a href="{{ url_for('pricing') }}" class="block py-2 text-text-secondary hover:text-primary transition-quick">Pricing</a>
                <a href="{{ url_for('designs_gallery') }}" class="block py-2 text-text-secondary hover:text-primary transition-quick">My Designs</a>
                <a href="{{ url_for('tech_deep_dive') }}" class="block py-2 text-text-secondary hover:text-primary transition-quick">Technology</a>
                <a href="{{ url_for('contact') }}" class="block py-2 text-text-secondary hover:text-primary transition-quick">Contact</a>
                <button class="block py-2 mt-4 text-secondary font-semibold">Save Progress</button>
            </div>
        </div>
    </nav>

    <main>
        <section class="py-12 bg-background">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <!-- 2D Floor Plan SVG -->
                <div id="svg-container"></div>

                <!-- User Details -->
                <div class="details-box">
                    <h2>Your Design Details</h2>
                    <ul class="details-list" id="details-list">
                        <!-- Details will be populated by JavaScript -->
                    </ul>
                </div>

                <!-- Action Buttons -->
                <div class="action-btns">
                    <button class="btn-secondary" id="generate-btn" type="button">Generate Design</button>
                    <button class="btn-main" id="proceed-btn" type="button">Proceed</button>
                </div>
            </div>
        </section>
    </main>
    <script>
    function generateSVG(formData) {
        let rooms = 1;
        let label = "Open Space";
        let fill = "#e0e7ff";
        let textColor = "#3730a3";
        let details = "";

        if (formData['family-size-btn']) {
            if (formData['family-size-btn'] === "1-2") { rooms = 2; label = "Living + Bedroom"; }
            if (formData['family-size-btn'] === "3-4") { rooms = 3; label = "Living + 2 Bedrooms"; }
            if (formData['family-size-btn'] === "5-6") { rooms = 4; label = "Living + 3 Bedrooms"; }
            if (formData['family-size-btn'] === "7+") { rooms = 5; label = "Living + 4 Bedrooms"; }
        }
        if (formData['style-btn']) {
            details += "Style: " + formData['style-btn'].charAt(0).toUpperCase() + formData['style-btn'].slice(1) + " ";
        }
        if (formData['size-btn']) {
            details += "| Size: " + formData['size-btn'] + " sq ft ";
        }
        if (formData['floor-btn']) {
            details += "| Floors: " + formData['floor-btn'] + " ";
        }

        const width = 600, height = 340;
        let svg = `<svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" class="svg-floorplan">
            <rect x="20" y="20" width="${width-40}" height="${height-40}" rx="30" fill="${fill}" stroke="#6366f1" stroke-width="4"/>
            <text x="${width/2}" y="60" text-anchor="middle" font-size="2rem" fill="${textColor}" font-family="Arial" font-weight="bold">${label}</text>
        `;

        // Draw rooms as rectangles
        const roomWidth = (width-80)/rooms, roomHeight = height-140;
        for(let i=0; i<rooms; i++) {
            svg += `<rect x="${40+i*roomWidth}" y="100" width="${roomWidth-10}" height="${roomHeight}" rx="16" fill="#fff" stroke="#6366f1" stroke-width="2"/>`;
            svg += `<text x="${40+i*roomWidth+roomWidth/2-5}" y="${100+roomHeight/2}" text-anchor="middle" font-size="1.1rem" fill="#6366f1" font-family="Arial">Room ${i+1}</text>`;
        }
        svg += `<text x="${width/2}" y="${height-40}" text-anchor="middle" font-size="1rem" fill="#64748b" font-family="Arial">${details}</text>`;
        svg += "</svg>";
        return svg;
    }

    function updateDetails(formData) {
        const detailsList = document.getElementById('details-list');
        detailsList.innerHTML = ''; // Clear existing details

        if (formData && Object.keys(formData).length > 0) {
            const details = {
                'size-btn': 'Preferred Home Size',
                'floor-btn': 'Number of Floors',
                'style-btn': 'Design Style',
                'family-size-btn': 'Family Size',
                'children-count': 'Children',
                'couples-count': 'Couples',
                'singles-count': 'Singles'
            };

            for (const key in details) {
                if (formData[key]) {
                    const li = document.createElement('li');
                    let value = formData[key];
                    if (key === 'style-btn') {
                        value = value.charAt(0).toUpperCase() + value.slice(1);
                    }
                    if (key === 'size-btn') {
                        value += ' sq ft';
                    }
                    li.innerHTML = `<strong>${details[key]}:</strong> ${value}`;
                    detailsList.appendChild(li);
                }
            }
        } else {
            const li = document.createElement('li');
            li.textContent = 'No design data found. Please create a design first.';
            detailsList.appendChild(li);
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const savedData = localStorage.getItem('designFormData');
        let formData = {};
        if (savedData) {
            formData = JSON.parse(savedData);
        }

        updateDetails(formData);
        document.getElementById('svg-container').innerHTML = generateSVG(formData);

        document.getElementById('generate-btn').addEventListener('click', function() {
            const styles = ['modern', 'traditional', 'contemporary', 'farmhouse', 'industrial', 'transitional'];
            const newStyle = styles[Math.floor(Math.random() * styles.length)];
            formData['style-btn'] = newStyle;
            
            // Update UI and save to localStorage
            document.getElementById('svg-container').innerHTML = generateSVG(formData);
            updateDetails(formData);
            localStorage.setItem('designFormData', JSON.stringify(formData));
        });

        document.getElementById('proceed-btn').addEventListener('click', function() {
            // Set default values
            let area = 1500;
            let rooms = 2;
            let floors = 1;

            // Overwrite with form data if it exists
            if (formData) {
                const familySize = formData['family-size-btn'];
                if (familySize === "3-4") rooms = 3;
                if (familySize === "5-6") rooms = 4;
                if (familySize === "7+") rooms = 5;

                area = parseInt(formData['size-btn'], 10) || area;
            }

            const floorPlan = {
                area: area,
                rooms: rooms,
                floors: floors,
                style: formData ? formData['style-btn'] : 'modern'
            };
            localStorage.setItem('floorPlan', JSON.stringify(floorPlan));

            // Redirect to the pricing page
            window.location.href = "{{ url_for('pricing') }}";
        });
    });
    </script>
</body>
</html>
